{% extends "base.html" %}

{% block title %}{{ podcast.name }} Â· Podcast{% endblock %}

{% block content %}
<section class="panel">
    <div class="panel-header">
        <div>
            <h2>{{ podcast.name }}</h2>
            <p>{{ podcast.description | striptags | trim or "No description available." }}</p>
        </div>
        <div class="podcast-detail-meta">
            <span class="meta-chip">Episodes: {{ stats.episode_count }}</span>
            <span class="meta-chip">Transcribed: {{ stats.transcribed_count }}</span>
            <span class="meta-chip">Category: {{ podcast.category or "Unknown" }}</span>
            <span class="meta-chip">Language: {{ podcast.language or "Unknown" }}</span>
        </div>
    </div>
    {% if podcast.website %}
    <a class="cta tertiary" href="{{ podcast.website }}" target="_blank" rel="noopener">Visit official site</a>
    {% endif %}
</section>

<section class="panel">
    <div class="panel-header">
        <div>
            <h3>Episodes</h3>
            <p>Newest episodes appear first.</p>
        </div>
    </div>
    <div class="table-wrapper">
    <table class="episodes-table">
        <thead>
            <tr>
                <th>Title</th>
                <th>Published</th>
                <th>Duration</th>
                <th>Confidence</th>
                <th>Keywords</th>
            </tr>
        </thead>
        <tbody>
        {% for episode in episodes %}
            <tr>
                <td><a href="{{ url_for('episode_detail', podcast_slug=podcast.name|slugify, episode_id=episode.id) }}">{{ episode.title }}</a></td>
                <td>{{ episode.published_at.date() if episode.published_at else "Unknown" }}</td>
                <td>{{ episode.duration|format_duration }}</td>
                {% set conf = episode.transcript.confidence if episode.transcript else None %}
                <td>{{ "%.2f"|format(conf) if conf is not none else "N/A" }}</td>
                <td>
                    {% set top = episode.keywords[:5] %}
                    {% if top %}
                        {{ top | map(attribute='keyword') | join(', ') }}
                    {% else %}
                        n/a
                    {% endif %}
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="5">No episodes available for this podcast yet.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
    {% if total_pages > 1 %}
    <div class="pagination">
        {% if page > 1 %}
            <a class="cta tertiary" href="{{ url_for('podcast_detail', podcast_slug=podcast.name|slugify, page=page-1) }}">Previous</a>
        {% endif %}
        <span>Page {{ page }} of {{ total_pages }}</span>
        {% if page < total_pages %}
            <a class="cta tertiary" href="{{ url_for('podcast_detail', podcast_slug=podcast.name|slugify, page=page+1) }}">Next</a>
        {% endif %}
    </div>
    {% endif %}
</section>
{% endblock %}
